<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MetApplication — Long Term Drought Odds</title>
  <style>
    :root{
      --bg:#05070b;
      --panel:#0b0f16;
      --panel2:#0a0d14;
      --line:#1a2230;
      --muted:#93a0b5;
      --text:#e8edf6;
      --blue:#66aaff;
      --blue2:#8bc1ff;
      --good:#2cc38a;
      --warn:#f3c969;
      --bad:#ff6b6b;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 20% 0%, rgba(102,170,255,.10), transparent 55%),
                  radial-gradient(1200px 700px at 80% 10%, rgba(120,255,220,.06), transparent 55%),
                  var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .wrap{max-width:1200px;margin:0 auto;padding:28px 22px 48px}
    header{
      display:flex;align-items:flex-start;justify-content:space-between;gap:18px;
      padding-bottom:18px;border-bottom:1px solid rgba(255,255,255,.06);
    }
    .brand{
      display:flex;flex-direction:column;gap:6px;
    }
    .brand h1{
      margin:0;
      font-size:44px;
      letter-spacing:.14em;
      font-weight:800;
      line-height:1.0;
    }
    .brand .sub{
      color:var(--muted);
      letter-spacing:.18em;
      font-size:12px;
      font-weight:700;
    }
    .nav{
      display:flex;gap:10px;align-items:center;padding-top:6px;
    }
    .pill{
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      color:var(--text);
      padding:10px 14px;
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      box-shadow: 0 10px 25px rgba(0,0,0,.35);
    }
    .pill:hover{border-color: rgba(102,170,255,.35)}
    .grid{
      display:grid;
      grid-template-columns: 1.15fr 1fr;
      gap:18px;
      margin-top:22px;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-h{
      padding:18px 18px 14px;
      border-bottom:1px solid rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:space-between;
      letter-spacing:.14em;
      font-weight:800;
      color:#b8c4d8;
      text-transform:uppercase;
      font-size:12px;
    }
    .card-b{padding:18px}
    label{
      display:block;
      color:#b7c4d7;
      font-weight:800;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:12px;
      margin-bottom:10px;
    }
    select{
      width:100%;
      padding:16px 14px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(8,12,18,.85);
      color: var(--text);
      outline:none;
      font-size:18px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }
    select:focus{border-color: rgba(102,170,255,.45)}
    .btn{
      width:100%;
      margin-top:14px;
      padding:16px 16px;
      border-radius: 12px;
      border:1px solid rgba(102,170,255,.45);
      background: linear-gradient(180deg, rgba(102,170,255,.35), rgba(102,170,255,.18));
      color: var(--text);
      font-weight:900;
      font-size:18px;
      letter-spacing:.04em;
      cursor:pointer;
    }
    .btn:hover{filter:brightness(1.05)}
    .status{
      display:flex;align-items:center;gap:10px;margin-top:14px;
      color: var(--muted);
      font-weight:700;
    }
    .dot{width:10px;height:10px;border-radius:999px;background:#667;box-shadow:0 0 0 3px rgba(255,255,255,.05)}
    .dot.ok{background: var(--good)}
    .dot.err{background: var(--bad)}
    .dot.busy{background: var(--blue)}
    .big{
      font-size:64px;
      font-weight:900;
      letter-spacing:.02em;
      margin:6px 0 0;
    }
    .citytag{
      font-weight:900;
      letter-spacing:.16em;
      color:#b8c4d8;
      text-transform:uppercase;
    }
    .subtitle{
      color:var(--muted);
      font-weight:800;
      letter-spacing:.02em;
      margin-top:6px;
      font-size:18px;
    }
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      margin-top:16px;
    }
    .mini{
      border:1px solid rgba(255,255,255,.08);
      background: rgba(6,10,16,.55);
      border-radius: 14px;
      padding:14px;
    }
    .mini h4{
      margin:0 0 10px;
      letter-spacing:.14em;
      font-weight:900;
      text-transform:uppercase;
      color:#b8c4d8;
      font-size:12px;
    }
    .mini .val{
      font-size:16px;
      font-weight:800;
      color: var(--text);
      line-height:1.35;
    }
    .bars{
      border:1px solid rgba(255,255,255,.08);
      background: rgba(6,10,16,.55);
      border-radius: 14px;
      padding:14px;
      margin-top:14px;
    }
    .bars h4{margin:0 0 12px;letter-spacing:.14em;font-weight:900;text-transform:uppercase;color:#b8c4d8;font-size:12px}
    .bar{
      display:grid;
      grid-template-columns: 1fr 64px;
      gap:12px;
      align-items:center;
      margin:10px 0 14px;
    }
    .bar .name{font-weight:900;font-size:28px;letter-spacing:.01em}
    .bar .pct{font-weight:900;font-size:28px;color:#b8c4d8;text-align:right}
    .track{
      grid-column:1 / -1;
      height:14px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      overflow:hidden;
    }
    .fill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(102,170,255,.95), rgba(139,193,255,.95));
    }
    .note{
      margin-top:10px;
      color: var(--muted);
      font-weight:700;
      font-size:12px;
      letter-spacing:.02em;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .brand h1{font-size:34px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>MetApplication</h1>
        <div class="sub">LONG TERM DROUGHT ODDS</div>
      </div>
      <div class="nav">
        <a class="pill" href="/">High Temp</a>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <div class="card-h">
          <div>Inputs</div>
          <div class="citytag" id="cityTag">—</div>
        </div>
        <div class="card-b">
          <label for="city">City</label>
          <select id="city">
            <option value="den">Denver</option>
            <option value="nyc">New York City</option>
            <option value="dal">Dallas</option>
            <option value="chi">Chicago</option>
          </select>

          <button class="btn" id="go">Evaluate Drought Odds</button>

          <div class="status" id="status">
            <span class="dot ok" id="dot"></span>
            <span id="statusText">Ready</span>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="card-h">
          <div>Result</div>
          <div class="citytag" id="cityTop">—</div>
        </div>
        <div class="card-b">
          <div class="big" id="pctBig">—</div>
          <div class="subtitle">Expected drought through ~90 days</div>

          <div class="row">
            <div class="mini">
              <h4>Seasonal Drought Outlook</h4>
              <div class="val" id="sdoVal">—</div>
            </div>
            <div class="mini">
              <h4>3-Month Precip Outlook</h4>
              <div class="val" id="prVal">—</div>
            </div>
          </div>

          <div class="bars">
            <h4>Precip Signal</h4>

            <div class="bar">
              <div class="name">Drier bias</div>
              <div class="pct" id="dryPct">0%</div>
              <div class="track"><div class="fill" id="dryFill"></div></div>
            </div>

            <div class="bar" style="margin-top:6px;">
              <div class="name">Wetter bias</div>
              <div class="pct" id="wetPct">0%</div>
              <div class="track"><div class="fill" id="wetFill"></div></div>
            </div>

            <div class="note" id="note">—</div>
          </div>
        </div>
      </section>
    </div>
  </div>

<script>
  const $ = (id)=>document.getElementById(id);

  const cityNames = {
    den: "Denver",
    nyc: "New York City",
    dal: "Dallas",
    chi: "Chicago",
  };

  function setStatus(kind, text){
    const dot = $("dot");
    dot.className = "dot " + (kind || "ok");
    $("statusText").textContent = text;
  }

  function pct(x){
    return Math.round(x*100);
  }

  function fmtProbLine(pr){
    const d = pct(pr.dry), n = pct(pr.normal), w = pct(pr.wet);
    return `Dry ${d}% · Normal ${n}% · Wet ${w}%`;
  }

  function applyBars(pr){
    // show "bias" relative to equal chances
    const dryBias = Math.max(0, pr.dry - 1/3);
    const wetBias = Math.max(0, pr.wet - 1/3);

    const dryP = Math.round(dryBias * 150); // scales into a nicer UI range
    const wetP = Math.round(wetBias * 150);

    $("dryPct").textContent = `${dryP}%`;
    $("wetPct").textContent = `${wetP}%`;
    $("dryFill").style.width = `${Math.min(100, dryP)}%`;
    $("wetFill").style.width = `${Math.min(100, wetP)}%`;
  }

  async function evaluate(){
    const city = $("city").value;
    $("cityTag").textContent = cityNames[city] || "—";
    $("cityTop").textContent = (cityNames[city] || "—").toUpperCase();

    setStatus("busy", "Evaluating…");

    try{
      const res = await fetch("/api/drought", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({city})
      });

      if(!res.ok){
        const t = await res.text();
        setStatus("err", `HTTP ${res.status}`);
        $("pctBig").textContent = "—";
        $("sdoVal").textContent = "—";
        $("prVal").textContent = "—";
        $("note").textContent = t.slice(0,160);
        return;
      }

      const data = await res.json();

      const expected = data.expected_drought_90d;
      $("pctBig").textContent = `${(expected*100).toFixed(1)}%`;

      const sdo = data.components?.sdo ?? "—";
      const pr = data.components?.precip_probs ?? {dry:1/3, normal:1/3, wet:1/3};

      $("sdoVal").textContent = sdo;
      $("prVal").textContent = fmtProbLine(pr);
      applyBars(pr);

      const usdm = data.components?.usdm_category ?? "None";
      $("note").textContent = `USDM: ${usdm} · SDO: ${sdo}`;

      setStatus("ok", "OK");
    }catch(e){
      setStatus("err", "Network error");
      $("note").textContent = String(e);
    }
  }

  $("city").addEventListener("change", ()=>{
    const city = $("city").value;
    $("cityTag").textContent = cityNames[city] || "—";
    $("cityTop").textContent = (cityNames[city] || "—").toUpperCase();
  });

  $("go").addEventListener("click", evaluate);

  // init
  (function init(){
    const city = $("city").value;
    $("cityTag").textContent = cityNames[city] || "—";
    $("cityTop").textContent = (cityNames[city] || "—").toUpperCase();
    $("note").textContent = "—";
  })();
</script>
</body>
</html>
