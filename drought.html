<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MetApplication — Long Term Drought Odds</title>
  <style>
    :root{
      --bg:#05070a;
      --panel:#0b0f16;
      --panel2:#0e141e;
      --line:#1a2331;
      --muted:#93a4bd;
      --text:#e9eef8;
      --blue:#6bb6ff;
      --blue2:#9fd2ff;
      --chip:#0f1724;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", sans-serif;
      letter-spacing:.1px;
    }
    .topbar{
      display:flex; align-items:flex-end; justify-content:space-between;
      padding:22px 28px 14px;
      border-bottom:1px solid var(--line);
    }
    .brand{
      display:flex; flex-direction:column; gap:4px;
    }
    .brand .title{
      font-size:34px;
      font-weight:800;
      letter-spacing:1.6px;
    }
    .brand .sub{
      font-size:12px;
      color:var(--muted);
      letter-spacing:1.2px;
      text-transform:uppercase;
      font-weight:700;
    }
    .nav{
      display:flex; gap:10px; align-items:center;
    }
    .btn{
      appearance:none; border:1px solid var(--line);
      background:var(--panel);
      color:var(--text);
      padding:10px 12px;
      font-weight:700;
      letter-spacing:.6px;
      border-radius:10px; /* less rounded */
      cursor:pointer;
    }
    .btn:hover{border-color:#2a3850}
    .btn.primary{
      background:#122033;
      border-color:#274160;
      color:var(--blue2);
    }
    .wrap{
      max-width:1100px;
      margin:22px auto;
      padding:0 18px 40px;
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:18px;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));
      border:1px solid var(--line);
      border-radius:14px; /* less rounded */
      overflow:hidden;
      box-shadow:0 18px 60px rgba(0,0,0,.45);
    }
    .card .hd{
      padding:14px 16px;
      background:rgba(255,255,255,0.02);
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between;
      letter-spacing:1.2px;
      text-transform:uppercase;
      font-weight:800;
      color:#cfe2ff;
      font-size:12px;
    }
    .card .bd{padding:16px}
    label{
      display:block;
      color:var(--muted);
      font-size:12px;
      letter-spacing:1.2px;
      text-transform:uppercase;
      font-weight:800;
      margin-bottom:8px;
    }
    select{
      width:100%;
      padding:12px 12px;
      border-radius:10px;
      border:1px solid var(--line);
      background:var(--panel2);
      color:var(--text);
      font-size:16px;
      outline:none;
    }
    select:focus{border-color:#2f4d73}
    .sp{height:14px}
    .pill{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background:var(--chip);
      font-weight:900;
      letter-spacing:1px;
      text-transform:uppercase;
      font-size:12px;
      color:#cfe2ff;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;background:var(--blue);
      box-shadow:0 0 0 3px rgba(107,182,255,.12);
    }
    .big{
      font-size:44px;
      font-weight:900;
      letter-spacing:.6px;
      margin:10px 0 2px;
    }
    .muted{color:var(--muted)}
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .kv{
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px 12px;
      background:rgba(255,255,255,0.02);
    }
    .k{color:var(--muted); font-weight:900; letter-spacing:1.1px; text-transform:uppercase; font-size:12px}
    .v{margin-top:6px; font-size:16px; font-weight:800}
    .bars{
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px;
      background:rgba(255,255,255,0.02);
    }
    .barrow{
      display:flex; align-items:center; justify-content:space-between;
      margin:12px 0 8px;
      font-weight:900;
      letter-spacing:.4px;
    }
    .track{
      width:100%;
      height:12px;
      border-radius:999px;
      background:#0b0f16;
      border:1px solid var(--line);
      overflow:hidden;
    }
    .fill{
      height:100%;
      background:linear-gradient(90deg, var(--blue), var(--blue2));
      width:50%;
    }
    .small{font-size:12px;color:var(--muted);font-weight:700;letter-spacing:.4px}
    .err{
      margin-top:10px;
      color:#ffb4b4;
      font-weight:800;
    }
    @media (max-width: 980px){
      .wrap{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand">
      <div class="title">MetApplication</div>
      <div class="sub">Long Term Drought Odds</div>
    </div>
    <div class="nav">
      <a class="btn" href="/">High Temp</a>
      <button class="btn primary" id="runBtn">Evaluate</button>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="hd">Inputs</div>
      <div class="bd">
        <label>City</label>
        <select id="city">
          <option value="den">Denver</option>
          <option value="nyc">New York City</option>
          <option value="dal">Dallas</option>
          <option value="chi" selected>Chicago</option>
        </select>
        <div class="sp"></div>
        <div class="pill"><span class="dot"></span><span id="statusTxt">ready</span></div>
        <div class="err" id="errTxt" style="display:none;"></div>
      </div>
    </div>

    <div class="card">
      <div class="hd">
        <span>Result</span>
        <span id="cityName" style="opacity:.9; letter-spacing:1.4px;">—</span>
      </div>
      <div class="bd">
        <div class="big" id="odds">—</div>
        <div class="muted" style="font-weight:800; letter-spacing:.4px;">Expected drought through ~90 days</div>

        <div class="sp"></div>

        <div class="grid2">
          <div class="kv">
            <div class="k">Seasonal Drought Outlook</div>
            <div class="v" id="sdoCat">—</div>
            <div class="small" id="sdoValid">—</div>
          </div>
          <div class="kv">
            <div class="k">3-Month Precip Outlook</div>
            <div class="v" id="pCat">—</div>
            <div class="small" id="pValid">—</div>
          </div>
        </div>

        <div class="bars">
          <div class="k" style="margin-bottom:8px;">Precip Signal</div>

          <div class="barrow"><span>Drier bias</span><span id="drierPct">—</span></div>
          <div class="track"><div class="fill" id="drierFill" style="width:0%"></div></div>

          <div class="barrow" style="margin-top:14px;"><span>Wetter bias</span><span id="wetterPct">—</span></div>
          <div class="track"><div class="fill" id="wetterFill" style="width:0%"></div></div>

          <div class="small" style="margin-top:10px;" id="debugLine"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  const $ = (id)=>document.getElementById(id);

  function setStatus(t){
    $("statusTxt").textContent = t;
    $("errTxt").style.display = "none";
  }
  function setErr(t){
    $("errTxt").textContent = t;
    $("errTxt").style.display = "block";
  }

  async function evaluate(){
    const city = $("city").value;
    setStatus("loading");
    try{
      const res = await fetch(`/api/drought?city=${encodeURIComponent(city)}`);
      const data = await res.json();
      if(!res.ok || data.error){
        throw new Error(data.error || ("HTTP " + res.status));
      }

      $("cityName").textContent = (data.city_name || "—").toUpperCase();

      const odds = (data.expected_drought_prob!=null) ? (data.expected_drought_prob*100) : null;
      $("odds").textContent = (odds==null) ? "—" : (odds.toFixed(1) + "%");

      $("sdoCat").textContent = data.sdo_cat || "—";
      $("sdoValid").textContent = data.sdo_valid || "—";

      $("pCat").textContent = (data.precip_cat || "—") + (data.precip_prob!=null ? (" • " + (data.precip_prob*100).toFixed(0) + "%") : "");
      $("pValid").textContent = data.precip_valid || "—";

      const drier = Math.round((data.p_drier||0)*100);
      const wetter = Math.round((data.p_wetter||0)*100);

      $("drierPct").textContent = drier + "%";
      $("wetterPct").textContent = wetter + "%";
      $("drierFill").style.width = Math.max(0, Math.min(100, drier)) + "%";
      $("wetterFill").style.width = Math.max(0, Math.min(100, wetter)) + "%";

      const dbg = data.debug || {};
      $("debugLine").textContent = `SDO hit: ${dbg.sdo_hit ? "yes":"no"} • Precip hit: ${dbg.precip_hit ? "yes":"no"} • SDO layer: ${dbg.sdo_layer ?? "—"}`;

      setStatus("ready");
    }catch(e){
      setStatus("ready");
      setErr(String(e.message || e));
    }
  }

  $("runBtn").addEventListener("click", evaluate);
  $("city").addEventListener("change", evaluate);

  // auto-load once
  evaluate();
</script>
</body>
</html>
